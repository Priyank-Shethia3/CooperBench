diff --git a/tests/test_loader.py b/tests/test_loader.py
index b300c8f2..52201001 100644
--- a/tests/test_loader.py
+++ b/tests/test_loader.py
@@ -401,3 +401,189 @@ def test_pep_451_import_hook():
         assert "test.html" in package_loader.list_templates()
     finally:
         sys.meta_path[:] = before
+
+
+class TestFileSystemLoaderPathExpansion:
+    """Test path expansion functionality for environment variables and user home directory."""
+ 
+    def test_environment_variable_expansion(self, tmp_path):
+        """Test that environment variables are expanded in search paths."""
+        # Create a temporary directory structure
+        template_dir = tmp_path / "templates"
+        template_dir.mkdir()
+        (template_dir / "test.html").write_text("TEST_CONTENT")
+ 
+        # Set environment variable
+        original_value = os.environ.get("TEST_TEMPLATE_DIR")
+        os.environ["TEST_TEMPLATE_DIR"] = str(template_dir)
+ 
+        try:
+            # Test with environment variable
+            loader = loaders.FileSystemLoader("$TEST_TEMPLATE_DIR")
+            env = Environment(loader=loader)
+            tmpl = env.get_template("test.html")
+            assert tmpl.render().strip() == "TEST_CONTENT"
+ 
+            # Verify the path was expanded
+            assert loader.searchpath[0] == str(template_dir)
+        finally:
+            # Restore original environment
+            if original_value is None:
+                os.environ.pop("TEST_TEMPLATE_DIR", None)
+            else:
+                os.environ["TEST_TEMPLATE_DIR"] = original_value
+ 
+    def test_environment_variable_with_braces(self, tmp_path):
+        """Test environment variable expansion with ${VAR} syntax."""
+        template_dir = tmp_path / "templates"
+        template_dir.mkdir()
+        (template_dir / "test.html").write_text("BRACE_CONTENT")
+ 
+        original_value = os.environ.get("TEST_BRACE_DIR")
+        os.environ["TEST_BRACE_DIR"] = str(template_dir)
+ 
+        try:
+            loader = loaders.FileSystemLoader("${TEST_BRACE_DIR}")
+            env = Environment(loader=loader)
+            tmpl = env.get_template("test.html")
+            assert tmpl.render().strip() == "BRACE_CONTENT"
+            assert loader.searchpath[0] == str(template_dir)
+        finally:
+            if original_value is None:
+                os.environ.pop("TEST_BRACE_DIR", None)
+            else:
+                os.environ["TEST_BRACE_DIR"] = original_value
+ 
+    def test_user_home_directory_expansion(self, tmp_path, monkeypatch):
+        """Test that tilde (~) is expanded to user home directory."""
+        # Mock the home directory
+        fake_home = tmp_path / "fake_home"
+        fake_home.mkdir()
+        template_dir = fake_home / "templates"
+        template_dir.mkdir()
+        (template_dir / "home_test.html").write_text("HOME_CONTENT")
+ 
+        monkeypatch.setenv("HOME", str(fake_home))
+ 
+        loader = loaders.FileSystemLoader("~/templates")
+        env = Environment(loader=loader)
+        tmpl = env.get_template("home_test.html")
+        assert tmpl.render().strip() == "HOME_CONTENT"
+        assert loader.searchpath[0] == str(template_dir)
+ 
+    def test_combined_expansion(self, tmp_path, monkeypatch):
+        """Test combining environment variable and home directory expansion."""
+        fake_home = tmp_path / "fake_home"
+        fake_home.mkdir()
+ 
+        original_value = os.environ.get("TEMPLATE_SUBDIR")
+        os.environ["TEMPLATE_SUBDIR"] = "my_templates"
+        monkeypatch.setenv("HOME", str(fake_home))
+ 
+        template_dir = fake_home / "my_templates"
+        template_dir.mkdir()
+        (template_dir / "combined.html").write_text("COMBINED_CONTENT")
+ 
+        try:
+            loader = loaders.FileSystemLoader("~/${TEMPLATE_SUBDIR}")
+            env = Environment(loader=loader)
+            tmpl = env.get_template("combined.html")
+            assert tmpl.render().strip() == "COMBINED_CONTENT"
+            assert loader.searchpath[0] == str(template_dir)
+        finally:
+            if original_value is None:
+                os.environ.pop("TEMPLATE_SUBDIR", None)
+            else:
+                os.environ["TEMPLATE_SUBDIR"] = original_value
+ 
+    def test_multiple_paths_with_expansion(self, tmp_path):
+        """Test expansion with multiple search paths."""
+        # Create two template directories
+        dir1 = tmp_path / "templates1"
+        dir2 = tmp_path / "templates2"
+        dir1.mkdir()
+        dir2.mkdir()
+        (dir1 / "first.html").write_text("FIRST")
+        (dir2 / "second.html").write_text("SECOND")
+ 
+        original_dir1 = os.environ.get("TEMPLATE_DIR1")
+        original_dir2 = os.environ.get("TEMPLATE_DIR2")
+        os.environ["TEMPLATE_DIR1"] = str(dir1)
+        os.environ["TEMPLATE_DIR2"] = str(dir2)
+ 
+        try:
+            loader = loaders.FileSystemLoader(["$TEMPLATE_DIR1", "$TEMPLATE_DIR2"])
+            env = Environment(loader=loader)
+ 
+            tmpl1 = env.get_template("first.html")
+            tmpl2 = env.get_template("second.html")
+            assert tmpl1.render().strip() == "FIRST"
+            assert tmpl2.render().strip() == "SECOND"
+ 
+            assert loader.searchpath[0] == str(dir1)
+            assert loader.searchpath[1] == str(dir2)
+        finally:
+            for var, orig in [("TEMPLATE_DIR1", original_dir1), ("TEMPLATE_DIR2", original_dir2)]:
+                if orig is None:
+                    os.environ.pop(var, None)
+                else:
+                    os.environ[var] = orig
+ 
+    def test_undefined_environment_variable(self):
+        """Test behavior with undefined environment variables."""
+        # Ensure the variable doesn't exist
+        os.environ.pop("UNDEFINED_TEMPLATE_VAR", None)
+ 
+        loader = loaders.FileSystemLoader("$UNDEFINED_TEMPLATE_VAR/templates")
+        # The path should remain unexpanded when the variable doesn't exist
+        assert "$UNDEFINED_TEMPLATE_VAR/templates" in loader.searchpath[0]
+ 
+    def test_empty_environment_variable(self, tmp_path):
+        """Test behavior with empty environment variables."""
+        template_dir = tmp_path / "templates"
+        template_dir.mkdir()
+        (template_dir / "empty_test.html").write_text("EMPTY_TEST")
+ 
+        os.environ["EMPTY_TEMPLATE_VAR"] = ""
+ 
+        try:
+            loader = loaders.FileSystemLoader("${EMPTY_TEMPLATE_VAR}templates")
+            # Should result in just "templates" as the path
+            assert loader.searchpath[0] == "templates"
+        finally:
+            os.environ.pop("EMPTY_TEMPLATE_VAR", None)
+ 
+    def test_no_expansion_needed(self, tmp_path):
+        """Test that regular paths work unchanged."""
+        template_dir = tmp_path / "regular_templates"
+        template_dir.mkdir()
+        (template_dir / "regular.html").write_text("REGULAR_CONTENT")
+ 
+        loader = loaders.FileSystemLoader(str(template_dir))
+        env = Environment(loader=loader)
+        tmpl = env.get_template("regular.html")
+        assert tmpl.render().strip() == "REGULAR_CONTENT"
+        assert loader.searchpath[0] == str(template_dir)
+ 
+    def test_pathlib_path_expansion(self, tmp_path):
+        """Test that PathLike objects are properly handled with expansion."""
+        template_dir = tmp_path / "pathlib_templates"
+        template_dir.mkdir()
+        (template_dir / "pathlib_test.html").write_text("PATHLIB_CONTENT")
+ 
+        original_value = os.environ.get("PATHLIB_TEMPLATE_DIR")
+        os.environ["PATHLIB_TEMPLATE_DIR"] = str(template_dir)
+ 
+        try:
+            # Use Path object with environment variable
+            from pathlib import Path
+            loader = loaders.FileSystemLoader(Path("$PATHLIB_TEMPLATE_DIR"))
+            env = Environment(loader=loader)
+            tmpl = env.get_template("pathlib_test.html")
+            assert tmpl.render().strip() == "PATHLIB_CONTENT"
+            assert loader.searchpath[0] == str(template_dir)
+        finally:
+            if original_value is None:
+                os.environ.pop("PATHLIB_TEMPLATE_DIR", None)
+            else:
+                os.environ["PATHLIB_TEMPLATE_DIR"] = original_value

