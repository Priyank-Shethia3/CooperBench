diff --git a/tests/test_async_filters.py b/tests/test_async_filters.py
index 5d4f332e..08ae0ea6 100644
--- a/tests/test_async_filters.py
+++ b/tests/test_async_filters.py
@@ -94,6 +94,69 @@ def test_groupby_multidot(env_async, articles):
     ]
 
 
+@mark_dualiter(
+    "users",
+    lambda: [
+        {"name": "emma", "city": "NY"},
+        {"name": "john", "city": "NY"},
+        {"name": "smith", "city": "WA"},
+    ],
+)
+def test_groupby_with_counts(env_async, users):
+    tmpl = env_async.from_string(
+        "{% for city, items, count in users()|groupby('city', with_counts=true) %}"
+        "{{ city }}: {{ count }} users - {{ items|map(attribute='name')|join(', ') }}\n"
+        "{% endfor %}"
+    )
+    assert tmpl.render(users=users) == "NY: 2 users - emma, john\nWA: 1 users - smith\n"
+
+
+def test_groupby_with_counts_empty(env_async):
+    tmpl = env_async.from_string(
+        "{% for key, items, count in data|groupby('type', with_counts=true) %}"
+        "{{ key }}: {{ count }}\n"
+        "{% endfor %}"
+    )
+    assert tmpl.render(data=[]) == ""
+
+
+@mark_dualiter(
+    "data",
+    lambda: [
+        {"category": "books", "title": "Book1"},
+        {"category": "books", "title": "Book2"},
+        {"category": "movies", "title": "Movie1"},
+        {"category": "games", "title": "Game1"},
+        {"category": "games", "title": "Game2"},
+        {"category": "games", "title": "Game3"},
+    ],
+)
+def test_groupby_with_counts_multiple_groups(env_async, data):
+    tmpl = env_async.from_string(
+        "{% for key, items, count in data()|groupby('category', with_counts=true) %}"
+        "{{ key }}: {{ count }}\n"
+        "{% endfor %}"
+    )
+    assert tmpl.render(data=data) == "books: 2\ngames: 3\nmovies: 1\n"
+
+
+@mark_dualiter(
+    "data",
+    lambda: [
+        {"category": "books", "title": "Book1"},
+        {"title": "Unknown1"},
+        {"title": "Unknown2"},
+    ],
+)
+def test_groupby_with_counts_and_default(env_async, data):
+    tmpl = env_async.from_string(
+        "{% for key, items, count in data()|groupby('category', default='misc', with_counts=true) %}"
+        "{{ key }}: {{ count }}\n"
+        "{% endfor %}"
+    )
+    assert tmpl.render(data=data) == "books: 1\nmisc: 2\n"
+
+
 @mark_dualiter("int_items", lambda: [1, 2, 3])
 def test_join_env_int(env_async, int_items):
     tmpl = env_async.from_string('{{ items()|join("|") }}')
diff --git a/tests/test_filters.py b/tests/test_filters.py
index 43ddf59c..edc908da 100644
--- a/tests/test_filters.py
+++ b/tests/test_filters.py
@@ -619,6 +619,78 @@ class TestFilter:
         )
         assert out == "NY: emma, john\nWA: smith\n"
 
+    def test_groupby_with_counts(self, env):
+        tmpl = env.from_string(
+            "{% for city, items, count in users|groupby('city', with_counts=true) %}"
+            "{{ city }}: {{ count }} users - {{ items|map(attribute='name')|join(', ') }}\n"
+            "{% endfor %}"
+        )
+        out = tmpl.render(
+            users=[
+                {"name": "emma", "city": "NY"},
+                {"name": "john", "city": "NY"},
+                {"name": "smith", "city": "WA"},
+            ]
+        )
+        assert out == "NY: 2 users - emma, john\nWA: 1 users - smith\n"
+
+    def test_groupby_with_counts_empty_groups(self, env):
+        tmpl = env.from_string(
+            "{% for key, items, count in data|groupby('type', with_counts=true) %}"
+            "{{ key }}: {{ count }}\n"
+            "{% endfor %}"
+        )
+        out = tmpl.render(data=[])
+        assert out == ""
+
+    def test_groupby_with_counts_single_group(self, env):
+        tmpl = env.from_string(
+            "{% for key, items, count in data|groupby('type', with_counts=true) %}"
+            "{{ key }}: {{ count }} items\n"
+            "{% endfor %}"
+        )
+        out = tmpl.render(
+            data=[
+                {"type": "A", "value": 1},
+                {"type": "A", "value": 2},
+                {"type": "A", "value": 3},
+            ]
+        )
+        assert out == "A: 3 items\n"
+
+    def test_groupby_with_counts_multiple_groups(self, env):
+        tmpl = env.from_string(
+            "{% for key, items, count in data|groupby('category', with_counts=true) %}"
+            "{{ key }}: {{ count }}\n"
+            "{% endfor %}"
+        )
+        out = tmpl.render(
+            data=[
+                {"category": "books", "title": "Book1"},
+                {"category": "books", "title": "Book2"},
+                {"category": "movies", "title": "Movie1"},
+                {"category": "games", "title": "Game1"},
+                {"category": "games", "title": "Game2"},
+                {"category": "games", "title": "Game3"},
+            ]
+        )
+        assert out == "books: 2\ngames: 3\nmovies: 1\n"
+
+    def test_groupby_with_counts_and_default(self, env):
+        tmpl = env.from_string(
+            "{% for key, items, count in data|groupby('category', default='misc', with_counts=true) %}"
+            "{{ key }}: {{ count }}\n"
+            "{% endfor %}"
+        )
+        out = tmpl.render(
+            data=[
+                {"category": "books", "title": "Book1"},
+                {"title": "Unknown1"},
+                {"title": "Unknown2"},
+            ]
+        )
+        assert out == "books: 1\nmisc: 2\n"
+
     def test_filtertag(self, env):
         tmpl = env.from_string(
             "{% filter upper|replace('FOO', 'foo') %}foobar{% endfilter %}"

