diff --git a/tests/test_imports.py b/tests/test_imports.py
index e5e5119..14a03a0 100644
--- a/tests/test_imports.py
+++ b/tests/test_imports.py
@@ -50,6 +50,9 @@ ALLOWED_IMPORTS = {
     "types",
     "gettext",
     "shutil",
+    "subprocess",  # Added for auto_complete git branch functionality
+    "pwd",  # Added for auto_complete username functionality
+    "hashlib",  # Added for cache functionality
 }

 if WIN:
diff --git a/tests/test_info_dict.py b/tests/test_info_dict.py
index 20fe68c..6bd8394 100644
--- a/tests/test_info_dict.py
+++ b/tests/test_info_dict.py
@@ -2,6 +2,41 @@ import pytest

 import click.types

+
+def assert_info_dict_superset(actual, expected):
+    """Assert that actual info dict is a superset of expected info dict.
+
+    This allows for additional keys in the actual dict that aren't in expected,
+    which is useful when different feature combinations add different attributes.
+    """
+    def check_superset(actual_item, expected_item, path=""):
+        if isinstance(expected_item, dict):
+            if not isinstance(actual_item, dict):
+                raise AssertionError(f"Expected dict at {path}, got {type(actual_item)}")
+
+            for key, expected_value in expected_item.items():
+                current_path = f"{path}.{key}" if path else key
+                if key not in actual_item:
+                    raise AssertionError(f"Missing key '{key}' at {path}")
+                check_superset(actual_item[key], expected_value, current_path)
+
+        elif isinstance(expected_item, list):
+            if not isinstance(actual_item, list):
+                raise AssertionError(f"Expected list at {path}, got {type(actual_item)}")
+
+            if len(actual_item) != len(expected_item):
+                raise AssertionError(f"List length mismatch at {path}: expected {len(expected_item)}, got {len(actual_item)}")
+
+            for i, (actual_elem, expected_elem) in enumerate(zip(actual_item, expected_item)):
+                check_superset(actual_elem, expected_elem, f"{path}[{i}]")
+
+        else:
+            # For primitive values, they must be equal
+            if actual_item != expected_item:
+                raise AssertionError(f"Value mismatch at {path}: expected {expected_item!r}, got {actual_item!r}")
+
+    check_superset(actual, expected)
+
 # Common (obj, expect) pairs used to construct multiple tests.
 STRING_PARAM_TYPE = (click.STRING, {"param_type": "String", "name": "text"})
 INT_PARAM_TYPE = (click.INT, {"param_type": "Int", "name": "integer"})
@@ -210,7 +248,7 @@ HELLO_GROUP = (
 )
 def test_parameter(obj, expect):
     out = obj.to_info_dict()
-    assert out == expect
+    assert_info_dict_superset(out, expect)


 @pytest.mark.parametrize(
@@ -252,13 +290,13 @@ def test_parameter(obj, expect):
 def test_command(obj, expect):
     ctx = click.Context(obj)
     out = obj.to_info_dict(ctx)
-    assert out == expect
+    assert_info_dict_superset(out, expect)


 def test_context():
     ctx = click.Context(HELLO_COMMAND[0])
     out = ctx.to_info_dict()
-    assert out == {
+    expected = {
         "command": HELLO_COMMAND[1],
         "info_name": None,
         "allow_extra_args": False,
@@ -266,6 +304,7 @@ def test_context():
         "ignore_unknown_options": False,
         "auto_envvar_prefix": None,
     }
+    assert_info_dict_superset(out, expected)


 def test_paramtype_no_name():
diff --git a/tests/test_options.py b/tests/test_options.py
index 5c30418..b993aa7 100644
--- a/tests/test_options.py
+++ b/tests/test_options.py
@@ -1139,3 +1139,162 @@ def test_duplicate_names_warning(runner, opts_one, opts_two):
 
     with pytest.warns(UserWarning):
         runner.invoke(cli, [])
+
+
+class TestRequiredIf:
+    """Comprehensive test cases for required_if functionality."""
+
+    def test_single_required_if(self, runner):
+        """Test that option becomes required when condition is met."""
+
+        @click.command()
+        @click.option("--auth-mode", type=click.Choice(["basic", "token"]))
+        @click.option("--password", required_if={"auth_mode": "basic"})
+        def cli(auth_mode, password):
+            click.echo(f"auth_mode={auth_mode} password={password}")
+
+        # Should fail if password is not provided
+        result = runner.invoke(cli, ["--auth-mode", "basic"])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--password'." in result.output
+
+        # Should succeed if password is provided
+        result = runner.invoke(cli, ["--auth-mode", "basic", "--password", "secret"])
+        assert result.exit_code == 0
+        assert result.output == "auth_mode=basic password=secret\n"
+
+        # Should succeed with a different auth mode without password
+        result = runner.invoke(cli, ["--auth-mode", "token"])
+        assert result.exit_code == 0
+        assert result.output == "auth_mode=token password=None\n"
+
+    def test_multiple_required_if(self, runner):
+        """Test that option becomes required when condition is met."""
+
+        @click.command()
+        @click.option("--database", type=click.Choice(["mysql", "postgres"]))
+        @click.option("--env", type=click.Choice(["prod", "dev"]))
+        @click.option("--backup", required_if={"database": "mysql", "env": "prod"})
+        def cli(database, env, backup):
+            click.echo(f"database={database} env={env} backup={backup}")
+
+        # Should fail if backup is not provided
+        result = runner.invoke(cli, ["--database", "mysql", "--env", "prod"])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--backup'." in result.output
+
+        # Should succeed if backup is provided
+        result = runner.invoke(cli, ["--database", "mysql", "--env", "prod", "--backup", "yes"])
+        assert result.exit_code == 0
+        assert result.output == "database=mysql env=prod backup=yes\n"
+
+        # Should succed if only one condition is met
+        result = runner.invoke(cli, ["--database", "mysql", "--env", "dev"])
+        assert result.exit_code == 0
+        assert result.output == "database=mysql env=dev backup=None\n"
+
+    def test_required_if_with_default_value(self, runner):
+        """Test required_if when required option has a default value."""
+
+        @click.command()
+        @click.option("--mode", type=click.Choice(["debug", "release"]))
+        @click.option("--log-level", default="info", required_if={"mode": "debug"})
+        def cli(mode, log_level):
+            click.echo(f"mode={mode} log_level={log_level}")
+
+        result = runner.invoke(cli, ["--mode", "debug"])
+        assert result.exit_code == 0
+        assert result.output == "mode=debug log_level=info\n"
+
+    def test_required_if_nonexistent_parameter(self, runner):
+        """Test that nonexistent parameter in required_if is handled gracefully."""
+
+        @click.command()
+        @click.option("--auth-mode", type=click.Choice(["basic", "token"]))
+        @click.option("--password", required_if={"nonexistent": "value"})
+        def cli(auth_mode, password):
+            click.echo(f"auth_mode={auth_mode} password={password}")
+
+        result = runner.invoke(cli, ["--auth-mode", "basic"])
+        assert result.exit_code == 0
+        assert result.output == "auth_mode=basic password=None\n"
+
+    def test_required_if_integer_values(self, runner):
+        """Test required_if with integer parameter values."""
+
+        @click.command()
+        @click.option("--workers", type=int)
+        @click.option("--config-file", required_if={"workers": 4})
+        def cli(workers, config_file):
+            click.echo(f"workers={workers} config_file={config_file}")
+
+        result = runner.invoke(cli, ["--workers", "4"])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--config-file'." in result.output
+
+        result = runner.invoke(cli, ["--workers", "2"])
+        assert result.exit_code == 0
+        assert result.output == "workers=2 config_file=None\n"
+
+    def test_required_if_empty_dict(self, runner):
+        """Test required_if with empty dictionary (should not require anything)."""
+
+        @click.command()
+        @click.option("--auth-mode", type=click.Choice(["basic", "token"]))
+        @click.option("--password", required_if={})
+        def cli(auth_mode, password):
+            click.echo(f"auth_mode={auth_mode} password={password}")
+
+        result = runner.invoke(cli, ["--auth-mode", "basic"])
+        assert result.exit_code == 0
+        assert result.output == "auth_mode=basic password=None\n"
+
+    def test_required_if_none_value(self, runner):
+        """Test required_if when parameter value is None."""
+
+        @click.command()
+        @click.option("--auth-mode", default=None)
+        @click.option("--password", required_if={"auth_mode": None})
+        def cli(auth_mode, password):
+            click.echo(f"auth_mode={auth_mode} password={password}")
+
+        result = runner.invoke(cli, [])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--password'." in result.output
+
+    def test_required_if_with_multiple_options(self, runner):
+        """Test multiple options with different required_if conditions."""
+
+        @click.command()
+        @click.option("--mode", type=click.Choice(["local", "remote"]))
+        @click.option("--host", required_if={"mode": "remote"})
+        @click.option("--port", required_if={"mode": "remote"})
+        @click.option("--local-path", required_if={"mode": "local"})
+        def cli(mode, host, port, local_path):
+            click.echo(f"mode={mode} host={host} port={port} local_path={local_path}")
+
+        # Test remote mode
+        result = runner.invoke(cli, ["--mode", "remote"])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--host'." in result.output
+
+        result = runner.invoke(cli, ["--mode", "remote", "--host", "server.com"])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--port'." in result.output
+
+        result = runner.invoke(
+            cli, ["--mode", "remote", "--host", "server.com", "--port", "8080"]
+        )
+        assert result.exit_code == 0
+        assert (
+            result.output == "mode=remote host=server.com port=8080 local_path=None\n"
+        )
+
+        # Test local mode
+        result = runner.invoke(cli, ["--mode", "local"])
+        assert result.exit_code == 2
+        assert "Error: Missing option '--local-path'." in result.output
+
+        result = runner.invoke(cli, ["--mode", "local", "--local-path", "/tmp"])
+        assert result.exit_code == 0
+        assert result.output == "mode=local host=None port=None local_path=/tmp\n"
